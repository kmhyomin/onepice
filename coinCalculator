import {useState, useEffect} from "react";

function App() {
  const [loading, setLoading] = useState(true);
  const [coins,setCoins] = useState([]);
  const [amount, setAmount] =useState("");
  const onChange= (event) => setAmount(event.target.value);
  const [selectCoin, setselectCoin] = useState();

  const coinCalculator = () => {
    if(!selectCoin || amount === "") return null
      const price = selectCoin.quotes.USD.price;
      const totalPrice = parseFloat(amount) / price;
      return totalPrice;
  };


  useEffect(() =>{
    fetch("https://api.coinpaprika.com/v1/tickers")
    .then((response) => response.json())
    .then(json => {
      setCoins(json);
      setLoading(false);
    });
  },[])
  
  return (
    <div>
      <h1> The Coins! {loading ? "" : `(${coins.length})`}</h1>
      <label>í˜„ì¬ ì†Œì§€ì¤‘ì¸ ìì‚°ì˜ ì•¡ìˆ˜ (ë‹¨ìœ„ : ì›) : </label>
      <input 
      type="number" 
      placeholder="ë‹¨ìœ„ëŠ” $ ì…ë‹ˆë‹¤."
      value={amount}
      onChange={onChange}
      ></input>
      
      <label> <br />ë°”ê¾¸ê³  ì‹¶ì€ ì½”ì¸: </label>
      {loading ? <strong>Loading...</strong> : 
        <select onChange={(event) => {
          const selected = coins.find((coin) => coin.id === event.target.value);
          console.log(event.target.value);
          setselectCoin(selected);
        }}>
          {coins.map((coin) => (
              <option 
                value={coin.id}
                key={coin.id}
              >
                {coin.name} ({coin.symbol}) : ${coin.quotes.USD.price} USD
              </option>
          ))
          }
        </select>
      }
      <h2>
          ğŸ’° ë„ˆì˜ ëˆ {amount === "" ? "0" : (parseFloat(amount) || 0).toLocaleString()}ì›ìœ¼ë¡œ <br />
          ğŸª™ {selectCoin ? selectCoin.name : "ì„ íƒëœ ì½”ì¸ ì—†ìŒ"} ì˜ ì½”ì¸ì„ <br />
          ğŸ“Š ì•½ {coinCalculator()?.toFixed(6)}(USD) ë‹¬ëŸ¬ ë³´ìœ  í•  ìˆ˜ ìˆì–´.
      </h2>
    </div>
  );
}

export default App;
